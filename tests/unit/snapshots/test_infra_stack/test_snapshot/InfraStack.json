{"Resources": {"demofunctionServiceRoleD7405739": {"Type": "AWS::IAM::Role", "Properties": {"AssumeRolePolicyDocument": {"Statement": [{"Action": "sts:AssumeRole", "Effect": "Allow", "Principal": {"Service": "lambda.amazonaws.com"}}], "Version": "2012-10-17"}, "ManagedPolicyArns": [{"Fn::Join": ["", ["arn:", {"Ref": "AWS::Partition"}, ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}, "demofunctionServiceRoleDefaultPolicy6CB8525B": {"Type": "AWS::IAM::Policy", "Properties": {"PolicyDocument": {"Statement": [{"Action": ["xray:PutTraceSegments", "xray:PutTelemetryRecords"], "Effect": "Allow", "Resource": "*"}], "Version": "2012-10-17"}, "PolicyName": "demofunctionServiceRoleDefaultPolicy6CB8525B", "Roles": [{"Ref": "demofunctionServiceRoleD7405739"}]}}, "demofunction8649910A": {"Type": "AWS::Lambda::Function", "Properties": {"Architectures": ["arm64"], "Code": {"S3Bucket": {"Fn::Sub": "cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}"}, "S3Key": "e7f7f7e3603dfe0537918f7f4e0d4f26984fdf5100da0a2c713f4eb1031fafe3.zip"}, "Environment": {"Variables": {"POWERTOOLS_SERVICE_NAME": "demo-function", "POWERTOOLS_LOG_LEVE": "INFO"}}, "Handler": "main.handler", "Layers": [{"Fn::Join": ["", ["arn:aws:lambda:", {"Ref": "AWS::Region"}, ":017000801446:layer:AWSLambdaPowertoolsPythonV3-python314-arm64:18"]]}], "MemorySize": 128, "Role": {"Fn::GetAtt": ["demofunctionServiceRoleD7405739", "Arn"]}, "Runtime": "python3.14", "TracingConfig": {"Mode": "Active"}}, "DependsOn": ["demofunctionServiceRoleDefaultPolicy6CB8525B", "demofunctionServiceRoleD7405739"]}, "demoapi7EEFB372": {"Type": "AWS::ApiGateway::RestApi", "Properties": {"Description": "Demo API", "Name": "demo-api"}}, "demoapiCloudWatchRoleC0135CA9": {"Type": "AWS::IAM::Role", "Properties": {"AssumeRolePolicyDocument": {"Statement": [{"Action": "sts:AssumeRole", "Effect": "Allow", "Principal": {"Service": "apigateway.amazonaws.com"}}], "Version": "2012-10-17"}, "ManagedPolicyArns": [{"Fn::Join": ["", ["arn:", {"Ref": "AWS::Partition"}, ":iam::aws:policy/service-role/AmazonAPIGatewayPushToCloudWatchLogs"]]}]}, "UpdateReplacePolicy": "Retain", "DeletionPolicy": "Retain"}, "demoapiAccount3E4DC5E3": {"Type": "AWS::ApiGateway::Account", "Properties": {"CloudWatchRoleArn": {"Fn::GetAtt": ["demoapiCloudWatchRoleC0135CA9", "Arn"]}}, "DependsOn": ["demoapi7EEFB372"], "UpdateReplacePolicy": "Retain", "DeletionPolicy": "Retain"}, "demoapiDeployment4278F758b3ec189ccb83d88ab6d95d72e066564c": {"Type": "AWS::ApiGateway::Deployment", "Properties": {"Description": "Demo API", "RestApiId": {"Ref": "demoapi7EEFB372"}}, "DependsOn": ["demoapihelloPOSTB3E54CB0", "demoapihello1A6A746D"], "Metadata": {"aws:cdk:do-not-refactor": true}}, "demoapiDeploymentStageprod63D09AC1": {"Type": "AWS::ApiGateway::Stage", "Properties": {"DeploymentId": {"Ref": "demoapiDeployment4278F758b3ec189ccb83d88ab6d95d72e066564c"}, "RestApiId": {"Ref": "demoapi7EEFB372"}, "StageName": "prod"}, "DependsOn": ["demoapiAccount3E4DC5E3"]}, "demoapihello1A6A746D": {"Type": "AWS::ApiGateway::Resource", "Properties": {"ParentId": {"Fn::GetAtt": ["demoapi7EEFB372", "RootResourceId"]}, "PathPart": "hello", "RestApiId": {"Ref": "demoapi7EEFB372"}}}, "demoapihelloPOSTApiPermissionteststackdemoapi683CC629POSThelloE614061F": {"Type": "AWS::Lambda::Permission", "Properties": {"Action": "lambda:InvokeFunction", "FunctionName": {"Fn::GetAtt": ["demofunction8649910A", "Arn"]}, "Principal": "apigateway.amazonaws.com", "SourceArn": {"Fn::Join": ["", ["arn:", {"Ref": "AWS::Partition"}, ":execute-api:", {"Ref": "AWS::Region"}, ":", {"Ref": "AWS::AccountId"}, ":", {"Ref": "demoapi7EEFB372"}, "/", {"Ref": "demoapiDeploymentStageprod63D09AC1"}, "/POST/hello"]]}}}, "demoapihelloPOSTApiPermissionTestteststackdemoapi683CC629POSThelloF9019428": {"Type": "AWS::Lambda::Permission", "Properties": {"Action": "lambda:InvokeFunction", "FunctionName": {"Fn::GetAtt": ["demofunction8649910A", "Arn"]}, "Principal": "apigateway.amazonaws.com", "SourceArn": {"Fn::Join": ["", ["arn:", {"Ref": "AWS::Partition"}, ":execute-api:", {"Ref": "AWS::Region"}, ":", {"Ref": "AWS::AccountId"}, ":", {"Ref": "demoapi7EEFB372"}, "/test-invoke-stage/POST/hello"]]}}}, "demoapihelloPOSTB3E54CB0": {"Type": "AWS::ApiGateway::Method", "Properties": {"AuthorizationType": "NONE", "HttpMethod": "POST", "Integration": {"IntegrationHttpMethod": "POST", "Type": "AWS_PROXY", "Uri": {"Fn::Join": ["", ["arn:", {"Ref": "AWS::Partition"}, ":apigateway:", {"Ref": "AWS::Region"}, ":lambda:path/2015-03-31/functions/", {"Fn::GetAtt": ["demofunction8649910A", "Arn"]}, "/invocations"]]}}, "ResourceId": {"Ref": "demoapihello1A6A746D"}, "RestApiId": {"Ref": "demoapi7EEFB372"}}}}, "Outputs": {"demoapiEndpoint4A922513": {"Value": {"Fn::Join": ["", ["https://", {"Ref": "demoapi7EEFB372"}, ".execute-api.", {"Ref": "AWS::Region"}, ".", {"Ref": "AWS::URLSuffix"}, "/", {"Ref": "demoapiDeploymentStageprod63D09AC1"}, "/"]]}}}, "Parameters": {"BootstrapVersion": {"Type": "AWS::SSM::Parameter::Value<String>", "Default": "/cdk-bootstrap/hnb659fds/version", "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]"}}, "Rules": {"CheckBootstrapVersion": {"Assertions": [{"Assert": {"Fn::Not": [{"Fn::Contains": [["1", "2", "3", "4", "5"], {"Ref": "BootstrapVersion"}]}]}, "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI."}]}}}